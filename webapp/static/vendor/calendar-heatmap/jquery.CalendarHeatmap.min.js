/*
 *  calendarheatmap - v0.0.3
 *  A simple Calendar Heatmap for jQuery.
 *  https://github.com/SeBassTian23/CalendarHeatmap
 *
 *  Made by Sebastian Kuhlgert
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c,d){this.element=b,this.data=c,this.settings=a.extend(!0,{},g,d),this._defaults=g,this._name=f,this.init()}var f="CalendarHeatmap",g={title:null,months:12,lastMonth:moment().month()+1,lastYear:moment().year(),coloring:null,labels:{days:!1,months:!0,custom:{weekDayLabels:null,monthLabels:null}},legend:{show:!0,align:"right",minLabel:"Less",maxLabel:"More"},tooltips:{show:!1,options:{}}};a.extend(e.prototype,{init:function(){this.calendarHeatmap(),moment||console.log("The calendar heatmap plugin requires moment.js")},weeksInMonth:function(a,b){var c=moment().set({year:b,month:a}).startOf("month").isoWeek(),d=moment().set({year:b,month:a}).endOf("month").isoWeek();return c>d&&(d+=c),d-c+1},pad:function(a,b){return a=String(a),a.length<b?this.pad("0"+a,b):a},calculateBins:function(a){var b,c=[],d=this.settings.steps||4,e=["0"];for(b in a)a[b].count=parseInt(a[b].count),c.push(a[b].count);var f=Math.min.apply(Math,c),g=(Math.max.apply(Math,c)-f)/d;for(0===g&&(g=Math.max.apply(Math,c)/d)<1&&(g=1),b=0;b<d;b++){var h=Math.round(b*g)+1;3===b?h+="+":(h+=" to ",h+=Math.round(b*g+g)),e.push(String(h))}for(b in a)a[b].count-f==0?a[b].level=Math.min(Math.floor(a[b].count/g),d-1)+1:a[b].level=Math.min(Math.floor((a[b].count-f)/g),d-1)+1;return 0===a.length&&(e=null),{events:a,bins:e}},matchDate:function(a,b){return a.find(function(a){return a.date===b})},calendarHeatmap:function(){if(this.data&&"array"===a.type(this.data)){var b,c=this.calculateBins(this.data),e=c.events,f=c.bins||["","","","",""],g=this.settings.lastMonth,h=this.settings.lastYear,i=this.settings.months;if(a(this.element).empty(),this.settings.title&&a("<h3>",{class:"ch-title",html:this.settings.title}).appendTo(a(this.element)),a(this.element).addClass("ch").append('<div class="ch-year"></div>'),this.settings.labels.days)for(a(".ch-year",this.element).append('<div class="ch-week-labels"></div>'),a(".ch-week-labels",this.element).append('<div class="ch-week-label-col"></div>'),this.settings.labels.months&&a(".ch-week-labels",this.element).append('<div class="ch-month-label">&nbsp;</div>'),a(".ch-week-label-col",this.element).append('<div class="ch-day-labels"></div>'),b=1;b<8;b++){var j=moment().weekday(b).format("ddd");if(b%2){var k=this.settings.labels.custom.weekDayLabels;"array"===a.type(k)?j=k[b-1]||"":"string"===a.type(k)&&(j=moment().weekday(b).format(k))}else j="&nbsp;";a("<div>",{class:"ch-day-label",html:j}).appendTo(a(".ch-day-labels",this.element))}for(b=i;b>0;b--){var l=g-b,m=h;l<0&&(m-=1,l+=12);var n=moment().set({month:l,year:m}).format("MMM");this.settings.labels.custom.monthLabels&&(n="array"===a.type(this.settings.labels.custom.monthLabels)?this.settings.labels.custom.monthLabels[l]||"":moment().set({month:l,year:m}).format(this.settings.labels.custom.monthLabels)),a(".ch-year",this.element).append('<div class="ch-month"></div>'),a(".ch-month:last",this.element).append('<div class="ch-weeks"></div>'),this.settings.labels.months&&a(".ch-month:last",this.element).append('<div class="ch-month-label">'+n+"</div>");for(var o=this.weeksInMonth(l,m),p=0;p<o;p++){a(".ch-month:last .ch-weeks",this.element).append('<div class="ch-week"></div>');var q=0;0===p&&(q=moment().set({month:l,year:m}).startOf("month").isoWeekday()-1),p===o-1&&(q=moment().set({month:l,year:m}).endOf("month").isoWeekday()-1);for(var r=0;r<7;r++)if(q>r&&0===p||q<r&&p===o-1)a(".ch-month:last .ch-weeks .ch-week:last",this.element).append('<div class="ch-day is-outside-month"></div>');else{var s=m+"-";s+=this.pad(l+1,2)+"-",s+=this.pad(7*p+(r+1)-moment().set({month:l,year:m}).startOf("month").isoWeekday()+1,2);var t=this.matchDate(e,s);if(t!==d){var u=t.count+" on ";u+=moment(t.date).format("ll"),a("<div>",{class:"ch-day lvl-"+t.level,title:u,"data-toggle":"tooltip"}).appendTo(a(".ch-month:last .ch-weeks .ch-week:last",this.element)),this.settings.coloring&&a(".ch-month:last .ch-weeks .ch-week:last .ch-day:last",this.element).addClass(this.settings.coloring+"-"+t.level)}else a("<div>",{class:"ch-day"}).appendTo(a(".ch-month:last .ch-weeks .ch-week:last",this.element))}}}if(this.settings.legend.show)for(a("<div>",{class:"ch-legend"}).appendTo(this.element).append("<small>"+this.settings.legend.minLabel+"</small>").append('<ul class="ch-lvls"></ul>').append("<small>"+this.settings.legend.maxLabel+"</small>"),"left"===this.settings.legend.align&&a(".ch-legend",this.element).addClass("ch-legend-left"),"center"===this.settings.legend.align&&a(".ch-legend",this.element).addClass("ch-legend-center"),b=0;b<5;b++)a("<li>",{class:"ch-lvl lvl-"+b,title:f[b],"data-toggle":"tooltip"}).appendTo(a(".ch-lvls",this.element)),this.settings.coloring&&a(".ch-lvls li:last",this.element).addClass(this.settings.coloring+"-"+b);this.settings.tooltips.show&&"function"==typeof a.fn.tooltip&&a('[data-toggle="tooltip"]',this.element).tooltip(this.settings.tooltips.options)}}}),a.fn[f]=function(b,c){return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b,c))})}}(jQuery,window,document);